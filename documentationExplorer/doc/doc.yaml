---
swagger: "2.0"

################################################################################
#                              API Information                                 #
################################################################################
info:
  version: "1.0"
  title: GreenAuto-Backend
  description: API
# during dev, should point to your local machine
host: "localhost:3000"
# basePath prefixes all resource paths
basePath: /v1
#
schemes:
  # tip: remove http to make production-grade
  - http
  - https
# format of bodies a client can send (Content-Type)
consumes:
  - application/json
# format of the responses to the client (Accepts)
produces:
  - application/json

################################################################################
#                                  Security                                    #
################################################################################

securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
    description: "Users login JWT with Bearer prefix. Example: Bearer <JWT>"

################################################################################
#                                           Paths                              #
################################################################################

paths:
  ##USERS
  /users/signup:
    post:
      security:
        - Bearer: []
      tags:
        - User
      summary: Add new user.
      description: "Requires logged in user to be menadzer or super_user."
      operationId: signUp
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: User object that needs to be added to the users.
          required: true
          schema:
            $ref: "#/definitions/UsersSignUpBody"
      responses:
        "201":
          description: User signed up.
          schema:
            $ref: "#/definitions/UsersSignUpResponse"


  /users/signin:
    post:
      tags:
        - User
      summary: Sign in.
      description: "Sign in."
      operationId: signIn
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: User credentials for sign in.
          required: true
          schema:
            $ref: "#/definitions/UsersSignInBody"
      responses:
        "201":
          description: User signed up.
          schema:
            $ref: "#/definitions/UsersSignUpResponse"

  /users/refresh_token:
    get:
      security:
        - Bearer: []
      tags:
        - User
      summary: Refresh login token..
      description: "Gets new login token."
      operationId: refreshToken
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        "200":
          description: User signed up.
          schema:
            $ref: "#/definitions/UsersSignUpResponse"

  /users:
    get:
      security:
        - Bearer: []
      tags:
        - User
      summary: Get all users.
      operationId: getUsers
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        "200":
          description: All users.
          schema:
            $ref: "#/definitions/UsersResponse"

  /users/{id}:
    get:
      security:
        - Bearer: []
      tags:
        - User
      summary: Get all users.
      operationId: getUsers
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the user that needs to be updated
          required: true
          type: string
      responses:
        "200":
          description: All users.
          schema:
            $ref: "#/definitions/DeleteUsersResponse"
    put:
      security:
        - Bearer: []
      tags:
        - User
      summary: Update user.
      description: "Requires logged in user to be super_user."
      operationId: updateUser
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the user that needs to be updated
          required: true
          type: string
        - in: body
          name: body
          description: Attributes and values that will be updated.
          required: true
          schema:
            $ref: "#/definitions/PutUsersBody"
      responses:
        "200":
          description: User updated.
          schema:
            $ref: "#/definitions/DeleteUsersResponse"

    delete:
      security:
        - Bearer: []
      tags:
        - User
      summary: Delete user.
      description: "Requires logged in user to be super_user."
      operationId: deleteUser
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the user that needs to be deleted.
          required: true
          type: string
      responses:
        "200":
          description: User deleted.
          schema:
            $ref: "#/definitions/DeleteUsersResponse"
########################################
#######POSLOVNICA
  /poslovnice:
    get:
      security:
        - Bearer: []
      tags:
        - Poslovnica
      summary: Get all poslovnice.
      description: "Requires logged in user to be super_user."
      operationId: getPoslovnice
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        "200":
          description: All poslovnice.
          schema:
            $ref: "#/definitions/PoslovnicaResponse"
    post:
      security:
        - Bearer: []
      tags:
        - Poslovnica
      summary: Add new poslovnica.
      description: "Requires logged in user to be super_user."
      operationId: createPoslovnica
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: Poslovnica object that needs to be added to the poslovnice.
          required: true
          schema:
            $ref: "#/definitions/PostPoslovniceBody"
      responses:
        "201":
          description: Poslovnica created.
          schema:
            $ref: "#/definitions/DeletePoslovniceResponse"
  /poslovnice/{id}:
    get:
      security:
        - Bearer: []
      tags:
        - Poslovnica
      summary: Get all poslovnice.
      description: "Requires logged in user to be super_user."
      operationId: getPoslovnica
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the poslovnica
          required: true
          type: string
      responses:
        "200":
          description: All users.
          schema:
            $ref: "#/definitions/DeletePoslovniceResponse"
    put:
      security:
        - Bearer: []
      tags:
        - Poslovnica
      summary: Update poslovnica.
      description: "Requires logged in user to be super_user."
      operationId: updatePoslovnica
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the poslovnica that needs to be updated
          required: true
          type: string
        - in: body
          name: body
          description: Attributes and values that will be updated.
          required: true
          schema:
            $ref: "#/definitions/PutPoslovniceBody"
      responses:
        "200":
          description: Poslovnica updated.
          schema:
            $ref: "#/definitions/DeletePoslovniceResponse"

    delete:
      security:
        - Bearer: []
      tags:
        - Poslovnica
      summary: Delete poslovnica.
      description: "Requires logged in user to be super_user."
      operationId: deleteUser
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          description: ID of the poslovnica that needs to be deleted.
          required: true
          type: string
      responses:
        "200":
          description: Poslovnica deleted.
          schema:
            $ref: "#/definitions/DeletePoslovniceResponse"
################################################################################
#                                 Definitions                                  #
################################################################################

definitions:
  #################################################
  #models
  User:
    type: object
    required:
      - id
      - username
      - ime
      - poslovnica
      - email
      - rola
      - createdAt
      - updatedAt
    properties:
      id:
        type: string
      username:
        type: string
      ime:
        type: string
      poslovnica:
        type: string
      email:
        type: string
      rola:
        type: string
        enum: ['korisnik', 'menadzer', 'super_user']
      createdAt:
        type: string
      updatedAt:
        type: string

  Poslovnica:
    type: object
    required:
      - id
      - ime
      - createdAt
      - updatedAt
    properties:
      id:
        type: string
      ime:
        type: string
      createdAt:
        type: string
      updatedAt:
        type: string
  #################################################################
  #################################################################
  #params

  ######################
  #Users
  UsersSignUpBody:
    type: object
    required:
      - username
      - ime
      - password
      - email
    properties:
      username:
        type: string
      ime:
        type: string
      password:
        type: string
      email:
        type: string

  PutUsersBody:
    type: object
    properties:
      username:
        type: string
      ime:
        type: string
      password:
        type: string
      email:
        type: string

  UsersSignInBody:
    type: object
    required:
      - username
      - password
    properties:
      username:
        type: string
      password:
        type: string

  ###############
  #Poslovnica
  PutPoslovniceBody:
    type: object
    properties:
      ime:
        type: string

  PostPoslovniceBody:
    type: object
    required:
      - ime
    properties:
      ime:
        type: string
  ###############################################################
  ###############################################################
  #responses

  ######################
  #Users
  UsersSignUpResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
        enum: ['success']
      data:
        type: object
        properties:
          token:
            type: string
            description: "JWT"
          user:
            $ref: "#/definitions/User"
  UsersResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
        enum: ['success']
      data:
        type: object
        required:
          - users
        properties:
          users:
            type: 'array'
            items:
              $ref: "#/definitions/User"

  DeleteUsersResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
        enum: ['success']
      data:
        type: object
        required:
          - user
        properties:
          user:
            $ref: "#/definitions/User"

###################
#Poslovnica
  PoslovnicaResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
        enum: ['success']
      data:
        type: object
        required:
          - poslovnice
        properties:
          poslovnice:
            type: 'array'
            items:
              $ref: "#/definitions/Poslovnica"

  DeletePoslovniceResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
        enum: ['success']
      data:
        type: object
        required:
          - poslovnica
        properties:
          user:
            $ref: "#/definitions/Poslovnica"
